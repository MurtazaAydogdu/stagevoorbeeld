---
version: '3.6'
services:
  artisan:
    image: docker-registry.bjoola.nl/microservicetransactions/release:${VERSION}
    networks:
      - traefik-net
    environment:
      - APP_URL=https://${VIRTUAL_HOST}
      - APP_DEBUG=true
      - APP_LOG_LEVEL=info
      - DB_CONNECTION=mysql
      - DB_HOST=192.168.0.227
      - DB_PORT=3306
      - DB_DATABASE=dev_microservice_transactions
      - DB_USERNAME=${DB_USERNAME}
      - DB_PASSWORD=${DB_PASSWORD}
      - CACHE_DRIVER=file
      - SESSION_DRIVER=file
      - SESSION_LIFETIME=120
      - QUEUE_DRIVER=sync
      # Registrator config
      - SERVICE_NAME=microservicetransactions
      - SERVICE_TAGS=traefik.enable=true
      - SERVICE_CHECK_HTTP=/api/health
      - SERVICE_CHECK_INTERVAL=15s
      - SERVICE_CHECK_TIMEOUT=5s
      - SERVICE_CHECK_INITIAL_STATUS=critical
      - MESSAGE_ADAPTER=message-adapter:3000
      - PUBLIC_KEY=LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0NCk1JSUNJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBZzhBTUlJQ0NnS0NBZ0VBb2hWN2VybXFQZHp2RXkrT1E3c2ENCmN0c0hheExiVW9vSS92Y0RwWEE5bkdYZmp2TkgxVjUvdW1DdnRqSURUQkR1TFJRTkNaTDJ5SlVNa0JTbk1LUjUNCjk0aUMvZlNEYkFNNm9aMUdSbUZSMERIbHlCQnVTR3dDODZ0WHc4elZIbEtrbWJiMXBCakFPZ3o1Q29CRm9udGINCnp0bmM5ZzBQOXMxVE5La0o1TDNxSFBYK05YVU04Z1p4QVZsT3U0NFcwRm9SUmhxeWF2ZCtJbmVUWFluUnBWZ1YNCjBYK0JhN3cyU2wvSVJxZy9kUVhTdS92RzJFZEpVNzZHeDFBNXJUQ2hZT2gvQWFBalUzTFFWU2pLUzRmRU5ZaEcNCmJMNmwrOHBUYWtTVWxFaTZsZVpBU0FPSW5uZjd2RDd2MEdZRUVwckVGeFpWZ3AyVCtncUhYVkhvelI0MGtqVWgNCkNRTHQzOGtNTzNHS2hUUjNmTGhwYUVKZXlPbVpYbXBaN1RVMTFKbXFCOXBVazJsY2RnSXFkR0h5OGJHcGEyVGsNCmNKTGRGU2VxcUdhamFEQ3NTaCtQUHpTK21JN3ZKeUtyd0FXTVJVSFprWkYyZXpoQzJKU29HVWppREljTW9aQlENCnJRNjcvQUZNZGNyN2ExV3RScS9PTHpkcmhKV3VUeVFsSnpJN3RlQU8rVzYvaVMxRUlWVTNvZ0ovTnU1TytsRXgNClFIcjA1QnVrRElCbjM5eWpJek9mZUxaNGVBL1hVaVhEbmdodUljYmgzVHZMMmNDY2NpaFNJWExlbXVvc2dlZTYNCndaYldtQ1RoMU9FM2VPSU02V3NWcW14c2x0OWZQZ3R0VzI5ejFlUUlnWlcxWVkyRHpITVBEN3hZYitaRHFPUzcNClJ0MGRPRUhwSkhHZ1lQQStQRmZ2bDAwQ0F3RUFBUT09DQotLS0tLUVORCBQVUJMSUMgS0VZLS0tLS0=

    deploy:
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 120s
  
  message-adapter:
      image: docker-registry.bjoola.nl/message-adapter/release:0.2.0-5b61371fcc
      networks:
        - traefik-net
      environment:
        - ADAPTER_CONFIG=ew0KICAgICJtZXRhIjogew0KICAgICAgICAiZGVmaW5pdGlvbnMiOiB7DQogICAgICAgICAgICAiSE9TVF9BUFBfTkFNRSI6ICJ0cmFuc2FjdGlvbl9hcGkiLA0KICAgICAgICAgICAgIkhPU1RfQVBJX1ZFUlNJT04iOiAiMiIsDQogICAgICAgICAgICAiSE9TVF9CQVNFX1VSTCI6ICJodHRwOi8vbWljcm9zZXJ2aWNldHJhbnNhY3Rpb25zLnplcm9rLm5sIg0KICAgICAgICB9DQogICAgfSwNCiAgICAibWFwcGluZ3MiOiBbDQogICAgICAgIHsNCiAgICAgICAgICAgICJmcm9tIjogew0KICAgICAgICAgICAgICAgICJyZXN0Ijogew0KICAgICAgICAgICAgICAgICAgICAiZW5kcG9pbnQiOiAiL3N0YXRlL2NyZWF0ZSIsDQogICAgICAgICAgICAgICAgICAgICJtZXRob2QiOiAiUE9TVCINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgInRvIjogew0KICAgICAgICAgICAgICAgICJyYWJiaXQiOiB7DQogICAgICAgICAgICAgICAgICAgICJyb3V0aW5nS2V5IjogInt7SE9TVF9BUFBfTkFNRX19Lnt7SE9TVF9BUElfVkVSU0lPTn19LmV2ZW50LnN0YXRlLmNyZWF0ZWQufn5xdWVyeS5zdGF0dXN+fi4qLn5+cXVlcnkub3JpZ2lufn4iDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgICAiZnJvbSI6IHsNCiAgICAgICAgICAgICAgICAicmVzdCI6IHsNCiAgICAgICAgICAgICAgICAgICAgImVuZHBvaW50IjogIi9zdGF0ZS9lZGl0IiwNCiAgICAgICAgICAgICAgICAgICAgIm1ldGhvZCI6ICJQQVRDSCINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgInRvIjogew0KICAgICAgICAgICAgICAgICJyYWJiaXQiOiB7DQogICAgICAgICAgICAgICAgICAgICJyb3V0aW5nS2V5IjogInt7SE9TVF9BUFBfTkFNRX19Lnt7SE9TVF9BUElfVkVSU0lPTn19LmV2ZW50LnN0YXRlLnVwZGF0ZWQufn5xdWVyeS5zdGF0dXN+fi4qLn5+cXVlcnkub3JpZ2lufn4iDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgICAiZnJvbSI6IHsNCiAgICAgICAgICAgICAgICAicmVzdCI6IHsNCiAgICAgICAgICAgICAgICAgICAgImVuZHBvaW50IjogIi9zdGF0ZS9kZWxldGUiLA0KICAgICAgICAgICAgICAgICAgICAibWV0aG9kIjogIkRFTEVURSINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgInRvIjogew0KICAgICAgICAgICAgICAgICJyYWJiaXQiOiB7DQogICAgICAgICAgICAgICAgICAgICJyb3V0aW5nS2V5IjogInt7SE9TVF9BUFBfTkFNRX19Lnt7SE9TVF9BUElfVkVSU0lPTn19LmV2ZW50LnN0YXRlLmRlbGV0ZWQufn5xdWVyeS5zdGF0dXN+fi4qLn5+cXVlcnkub3JpZ2lufn4iDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgICAiZnJvbSI6IHsNCiAgICAgICAgICAgICAgICAicmVzdCI6IHsNCiAgICAgICAgICAgICAgICAgICAgImVuZHBvaW50IjogIi90cmFuc2FjdGlvbi9pbi9jcmVhdGUiLA0KICAgICAgICAgICAgICAgICAgICAibWV0aG9kIjogIlBPU1QiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICJ0byI6IHsNCiAgICAgICAgICAgICAgICAicmFiYml0Ijogew0KICAgICAgICAgICAgICAgICAgICAicm91dGluZ0tleSI6ICJ7e0hPU1RfQVBQX05BTUV9fS57e0hPU1RfQVBJX1ZFUlNJT059fS5ldmVudC50cmFuc2FjdGlvbmluLmNyZWF0ZWQufn5xdWVyeS5zdGF0dXN+fi4qLn5+cXVlcnkub3JpZ2lufn4iDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgICAiZnJvbSI6IHsNCiAgICAgICAgICAgICAgICAicmVzdCI6IHsNCiAgICAgICAgICAgICAgICAgICAgImVuZHBvaW50IjogIi90cmFuc2FjdGlvbi9pbi9lZGl0IiwNCiAgICAgICAgICAgICAgICAgICAgIm1ldGhvZCI6ICJQQVRDSCINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgInRvIjogew0KICAgICAgICAgICAgICAgICJyYWJiaXQiOiB7DQogICAgICAgICAgICAgICAgICAgICJyb3V0aW5nS2V5IjogInt7SE9TVF9BUFBfTkFNRX19Lnt7SE9TVF9BUElfVkVSU0lPTn19LmV2ZW50LnRyYW5zYWN0aW9uaW4udXBkYXRlZC5+fnF1ZXJ5LnN0YXR1c35+Lioufn5xdWVyeS5vcmlnaW5+fiINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAgICJmcm9tIjogew0KICAgICAgICAgICAgICAgICJyZXN0Ijogew0KICAgICAgICAgICAgICAgICAgICAiZW5kcG9pbnQiOiAiL3RyYW5zYWN0aW9uL2luL2RlbGV0ZSIsDQogICAgICAgICAgICAgICAgICAgICJtZXRob2QiOiAiREVMRVRFIg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAidG8iOiB7DQogICAgICAgICAgICAgICAgInJhYmJpdCI6IHsNCiAgICAgICAgICAgICAgICAgICAgInJvdXRpbmdLZXkiOiAie3tIT1NUX0FQUF9OQU1FfX0ue3tIT1NUX0FQSV9WRVJTSU9OfX0uZXZlbnQudHJhbnNhY3Rpb25pbi5kZWxldGVkLn5+cXVlcnkuc3RhdHVzfn4uKi5+fnF1ZXJ5Lm9yaWdpbn5+Ig0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICAgImZyb20iOiB7DQogICAgICAgICAgICAgICAgInJlc3QiOiB7DQogICAgICAgICAgICAgICAgICAgICJlbmRwb2ludCI6ICIvdHJhbnNhY3Rpb24vb3V0L2NyZWF0ZSIsDQogICAgICAgICAgICAgICAgICAgICJtZXRob2QiOiAiUE9TVCINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgInRvIjogew0KICAgICAgICAgICAgICAgICJyYWJiaXQiOiB7DQogICAgICAgICAgICAgICAgICAgICJyb3V0aW5nS2V5IjogInt7SE9TVF9BUFBfTkFNRX19Lnt7SE9TVF9BUElfVkVSU0lPTn19LmV2ZW50LnRyYW5zYWN0aW9ub3V0LmNyZWF0ZWQufn5xdWVyeS5zdGF0dXN+fi4qLn5+cXVlcnkub3JpZ2lufn4iDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgICAiZnJvbSI6IHsNCiAgICAgICAgICAgICAgICAicmVzdCI6IHsNCiAgICAgICAgICAgICAgICAgICAgImVuZHBvaW50IjogIi90cmFuc2FjdGlvbi9vdXQvZWRpdCIsDQogICAgICAgICAgICAgICAgICAgICJtZXRob2QiOiAiUEFUQ0giDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICJ0byI6IHsNCiAgICAgICAgICAgICAgICAicmFiYml0Ijogew0KICAgICAgICAgICAgICAgICAgICAicm91dGluZ0tleSI6ICJ7e0hPU1RfQVBQX05BTUV9fS57e0hPU1RfQVBJX1ZFUlNJT059fS5ldmVudC50cmFuc2FjdGlvbm91dC51cGRhdGVkLn5+cXVlcnkuc3RhdHVzfn4uKi5+fnF1ZXJ5Lm9yaWdpbn5+Ig0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCiAgICAgICAgew0KICAgICAgICAgICAgImZyb20iOiB7DQogICAgICAgICAgICAgICAgInJlc3QiOiB7DQogICAgICAgICAgICAgICAgICAgICJlbmRwb2ludCI6ICIvdHJhbnNhY3Rpb24vb3V0L2RlbGV0ZSIsDQogICAgICAgICAgICAgICAgICAgICJtZXRob2QiOiAiREVMRVRFIg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAidG8iOiB7DQogICAgICAgICAgICAgICAgInJhYmJpdCI6IHsNCiAgICAgICAgICAgICAgICAgICAgInJvdXRpbmdLZXkiOiAie3tIT1NUX0FQUF9OQU1FfX0ue3tIT1NUX0FQSV9WRVJTSU9OfX0uZXZlbnQudHJhbnNhY3Rpb25vdXQuZGVsZXRlZC5+fnF1ZXJ5LnN0YXR1c35+Lioufn5xdWVyeS5vcmlnaW5+fiINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICAgICJmcm9tIjogew0KICAgICAgICAgICAgICAgICJyYWJiaXQiOiB7DQogICAgICAgICAgICAgICAgICAgICJyb3V0aW5nS2V5IjogInt7SE9TVF9BUFBfTkFNRX19Lnt7SE9TVF9BUElfVkVSU0lPTn19LmNvbW1hbmQudHJhbnNhY3Rpb25pbi5hZGQuKi4qLioiLA0KICAgICAgICAgICAgICAgICAgICAicXVldWUiOiAie3tIT1NUX0FQUF9OQU1FfX0uW1tmcm9tLnJhYmJpdC5yb3V0aW5nS2V5XV0iDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICJ0byI6IHsNCiAgICAgICAgICAgICAgICAicmVzdCI6IHsNCiAgICAgICAgICAgICAgICAgICAgImVuZHBvaW50IjogInt7SE9TVF9CQVNFX1VSTH19L3RyYW5zYWN0aW9uL2luL2NyZWF0ZSIsDQogICAgICAgICAgICAgICAgICAgICJtZXRob2QiOiAiUE9TVCIsDQogICAgICAgICAgICAgICAgICAgICJoZWFkZXJzIjogew0KICAgICAgICAgICAgICAgICAgICAgICAgImF1dGhvcml6YXRpb24iOiAifn5wcm9wZXJ0aWVzLmhlYWRlcnMuaGVhZGVycy5hdXRob3JpemF0aW9ufn4iDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgIF0NCn0=
        - APPLICATION_NAME=message-adapter
        - APPLICATION_PORT=3000
        - RABBIT_HOST=192.168.0.143
        - RABBIT_PORT=5672
        - RABBIT_USER=root
        - RABBIT_PASS=root
        - RABBIT_QUEUE_EXPIRES=3600000
        - RABBIT_QUEUE_DURABLE=true
        - RABBIT_QUEUE_MESSAGE_TTL=300000
      logging:
        driver: "json-file"
        options:
          max-size: "16m"
          max-file: "8"

networks:
  traefik-net:
    external: true