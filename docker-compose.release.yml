---
version: '3.6'
services:
  artisan:
    image: docker-registry.bjoola.nl/microservicetransactions/release:${VERSION}
    networks:
      - traefik-net
    environment:
      - APP_URL=https://${VIRTUAL_HOST}
      - APP_DEBUG=false
      - APP_LOG_LEVEL=info
      - DB_CONNECTION=mysql
      - DB_HOST=192.168.0.227
      - DB_PORT=3306
      - DB_DATABASE=dev_microservicetransactions
      - DB_USERNAME=${DB_USERNAME}
      - DB_PASSWORD=${DB_PASSWORD}
      - CACHE_DRIVER=file
      - SESSION_DRIVER=file
      - SESSION_LIFETIME=120
      - QUEUE_DRIVER=sync
      # Registrator config
      - SERVICE_NAME=microservicetransactions
      - SERVICE_TAGS=traefik.enable=true
      - SERVICE_CHECK_HTTP=/api/health
      - SERVICE_CHECK_INTERVAL=15s
      - SERVICE_CHECK_TIMEOUT=5s
      - SERVICE_CHECK_INITIAL_STATUS=critical 
    deploy:
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 120s

networks:
  traefik-net:
    external: true